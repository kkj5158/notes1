#네트워크 #DevOps 
`공유기를 사용하는 홈 네트워크 상에서 , 홈 서버 구축하기 `
참고자료
- [생활코딩 _ 홈서버_](https://www.youtube.com/watch?v=fTjscWEQ7zk&list=PLuHgQVnccGMA52uRBmSwqcvtI5IMoFclJ&index=8)


## 공인 , 사설 (WAN vs LAN)
간단하게 이야기하자면, WAN은 외부에서 접근가능한 인터넷망을 말하고, LAN은 내부 인터넷망을 말한다. WAN은 외부에서 전화가능한 대표번호이다. LAN은 내부 통신망에서 서로 연락을 주고 받을 수 있는 내선번호이다. 

![[WAN과 LAN의 차이.png]]
#### 1. 공인 IP (=외부 IP) (= WAN)
	외부에서 연락을 할 수 있는 회사의 대표번호와 같다. 

인터넷 사용자의 로컬 네트워크를 식별하기 위해 인터넷 서비스 공급자(ISP)가 제공하는 IP 주소입니다.공인 IP는 전세계에서 유일한 IP 주소를 갖으며 외부에 공개되어 있기 때문에 인터넷에 연결된 다른 PC로부터의 접근이 가능합니다.따라서 공인 IP 주소를 사용하는 경우에는 방화벽 등의 보안 프로그램을 설치할 필요가 있습니다.

#### 2. 사설 IP (=내부 IP) (=LAN)
	 사무실 내선 번호와 같다. 내부 네트워크 망끼리에서만 접근 가능하다. 
일반 가정이나 회사 내에 할당된 네트워크 IP 주소이고 로컬 IP라고도 불립니다.

IPv4 주소 부족으로 인해 서브넷팅된 IP이기 때문에 라우터에 의해 로컬 네트워크상의 PC나 장치에 할당됩니다.

사설 IP 주소는 다음과 같은 3가지 주소 대역으로 고정되며, 그 이외는 공인 IP라 볼 수 있습니다.

- Class A : 10.0.0.0 ~ 10.255.255.255
- Class B : 172.16.0.0 ~ 172.31.255.255
- Class C : 192.168.0.0 ~ 192.168.255.255



## 유동 , 고정 IP 

사실상, 같은 공유기 환경이 아닌 이상은 외부 ip를 통해서 구축된 서버에 접근해야한다. 문제는 이 외부 Ip가 보통 가정용 네트워크상에서는 유동 IP로 지정되어 있는 경우가 많다는 것이다. 이 말은 외부에서 서버를 이용할때 마다 , IP가 유동적으로 변경되니 사실상 서버로의 역할이 불가능하다는 의미이다. 이를 해결하기 위해서는 유동 IP를 고정 IP처럼 사용하는 과정이 필요하다. 두가지 방법이 있는데. 첫번째는 고정 IP를 구매하는것이고. 두번째는 공유기의 DDNS기능을 이용하는 것이다. 첫번째 방법의 경우는 추가비용이 매월 지출되므로 대부분 두번째 방법을 통해서 유동 IP를 고정 IP처럼 사용한다. 

## DDNS란? DDNS 사용하기

간단하게 말해서 기타 고정IP를 사용하지않는 환경에서 IP가 바뀌었을때 도메인과 매칭시켜주는 역할을 해줍니다.

예를들어 제 서버의 공인IP가 1.2.3.4 여서 DNS에 svrforum.com = 1.2.3.4 로 등록이 되어있다면 서버의 공유기가 리부팅되어 공인 ip가 바뀌어 1.2.3.4가 아닌 다른 ip가 할당된다면 아무도 제 사이트에 접근하지못할것입니다.

하지만 DDNS를 설정해두면 제 서버와 DNS 서버간 지속적인 통신으로 ip과 도메인을 지속적으로 매핑하여 혹 공인IP가 바뀌더라도 DNS에 바뀐 IP가 바로 업데이트 되게 됩니다. 

## DDNS 설정하기 

필자가 사용하는 LG U +의 공유기 설정 사이트는 다음과 같다. 

http://192.168.219.1/ 

상세 과정은 다음의 글을 참고하자. 

[[LG U+ 공유기 DDNS 설정]]


추가적으로, LAN상에서의 DHCP 개념역시 알아두면 좋기에 정리해둔다.

## DHCP 

동적 호스트 구성 프로토콜 (DHCP)는 **자동으로 IP (인터넷 프로토콜)를 호스트 하는 IP 주소 및 서브넷 마스크 및 기본 게이트웨이 등의 기타 관련된 구성 정보를 제공 하는 클라이언트/서버 프로토콜**입니다.

단순히 말하면 , LAN상에서 각각의 기기들에게 자동으로 ip를 할당하는 프로토콜을 의미한다. ( 현대 사회에서는 같은 공유기안에 컴퓨터,스마트폰,TV등 다양한 기기들이 네트워크를 할당 받으니 상황에 따라서 자동으로 ip를 할당해주는 DHCP를 사용하는것이다. ) 

서버를 구축할때는 이 DHCP를 고정해둬야한다. (즉 자동으로 할당되는것이 아니라 내부 ip 역시 고정되어있도록) 그래야 포트포워딩을 지정해둘때 올바른 포트포워딩이 이뤄진다. 

## 게이트 웨이 

사설 IP 상에서는 , 공유기 역시 하나의 기기 이므로 하나의 사설 IP 주소를 할당 받는다. 공유기는 외부에서 들어오는 공인 IP를 라우터 해주는 역할을 해주므로 다음과 같이. 사설 IP주소와 공인 IP주소 2가지 모두와 연관이 있다. 이 때 공유기가 가지는 사설 IP주소를 게이트웨이주소라고 한다. 
![[게이트웨이 주소.png]]


## 포트 포워딩

포트 포워딩은 **외부 아이피 : 포트번호와 내부 아이피 : 포트번호**를 연결해주는 기능이다.
![[포트포워딩.png]]



별도의 설정 없이 외부 아이피가 접속을 시도할 때, 내부에 어떤 프로세스(서비스) 또는 기기와 연결할 지 알 수 없기 때문에 접근이 불가능하다.

그래서 특정 프로세스(서비스) 또는 기기에 접근하기 위해 **포트 포워딩을 통해 `외부 아이피 : 특정 포트`로 접속하면 `내부 아이피 : 특정 포트`로 맵핑해준다.**


포트 포워딩 역시 대부분  , 본인이 사용하는 공유기를 통해서 설정이 가능하니 설정해두자. 
	대부분 구글링 하면 쉽게 찾을 수 있다

## DMZ 설정 
특정 ip 의 포트포워딩을 일일이 따로 설정을 하기도 하지만 DMZ 설정의 경우 말 그대로 쉽게 말해 비무장지대로 보안상 문제가 될 수 있지만 모든 포트를 전면 개방합니다.


## 인바운드 , 아웃바운드 규칙 

인바운드와 아웃바운드는 트래픽에 네트워크 간에 이동하는 방향을 말한다.

- 인바운드  
    - 인바운드 트래픽은 네트워크에 **들어오는** 정보  
    - 메시지가 클라이언트에서 서버로 향하는 것  
    ex) 첨부파일을 서버에 저장할 때(업로드)  
      
    
- 아웃바운드  
    - 아웃바운드 트래픽은 네트워크에서 **나가는** 정보  
    - 클라이언트의 요청을 처리하고 메시지가 서버에서 클라이언트로 다시 향하는 것  
    ex) 첨부파일을 다운로드 할 때
